{"version":3,"file":"DecisionRulesCellEditorComponent.js","names":["Component","isString","is","ContentEditable","LiteralExpression","Cell","DecisionRulesCellEditorComponent","constructor","props","context","changeCellValue","bind","onElementsChanged","forceUpdate","componentWillMount","injector","cell","changeSupport","_changeSupport","_modeling","get","id","componentWillUnmount","offElementsChanged","value","editCell","businessObject","render","rowIndex","row","col","colIndex","isUnaryTest","text","FeelEditor","state","focussed","onFocus","onBlur","setState","className","TableCellEditor","_expressionLanguages","_translate","_variableResolver","isDefaultExpressionLanguage","expressionLanguage","defaultExpressionLanguage","getDefaultExpressionLanguage","getDescription","description","getExpressionLanguageLabel","getLabel","label","isScript","isInputCell","indexOf","elementType","getDefault","getEditor","isFEEL","getExpressionLanguage","_getVariables","getVariables","placeholder","onChange","expressionLanguageLabel","Editor","variables"],"sources":["../../../../src/features/decision-rules/components/DecisionRulesCellEditorComponent.js"],"sourcesContent":["import { Component } from 'inferno';\n\nimport { isString } from 'min-dash';\n\nimport { is } from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport ContentEditable from 'dmn-js-shared/lib/components/ContentEditable';\nimport LiteralExpression from 'dmn-js-shared/lib/components/LiteralExpression';\n\nimport { Cell } from 'table-js/lib/components';\n\n\nexport default class DecisionRulesCellEditorComponent extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.changeCellValue = this.changeCellValue.bind(this);\n    this.onElementsChanged = this.onElementsChanged.bind(this);\n  }\n\n  onElementsChanged() {\n    this.forceUpdate();\n  }\n\n  componentWillMount() {\n    const { injector } = this.context;\n\n    const { cell } = this.props;\n\n    const changeSupport = this._changeSupport = this.context.changeSupport;\n\n    this._modeling = injector.get('modeling');\n\n    changeSupport.onElementsChanged(cell.id, this.onElementsChanged);\n  }\n\n  componentWillUnmount() {\n    const { cell } = this.props;\n\n    this._changeSupport.offElementsChanged(cell.id, this.onElementsChanged);\n  }\n\n  changeCellValue(value) {\n    const { cell } = this.props;\n\n    this._modeling.editCell(cell.businessObject, value);\n  }\n\n  render() {\n    const {\n      cell,\n      rowIndex,\n      row,\n      col,\n      colIndex\n    } = this.props;\n\n    const isUnaryTest = is(cell, 'dmn:UnaryTests');\n    const businessObject = cell.businessObject;\n\n    return (\n      <Cell\n        className={ isUnaryTest ? 'input-cell' : 'output-cell' }\n        elementId={ cell.id }\n        coords={ `${rowIndex}:${colIndex}` }\n        data-row-id={ row.id }\n        data-col-id={ col.id }\n      >\n        <TableCellEditor\n          placeholder={ isUnaryTest ? '-' : '' }\n          onChange={ this.changeCellValue }\n          value={ businessObject.text }\n          businessObject={ businessObject } />\n      </Cell>\n    );\n  }\n}\n\nclass FeelEditor extends Component {\n  constructor(props, context) {\n    super(props, context);\n    this.state = { focussed: false };\n\n    this.onFocus = this.onFocus.bind(this);\n    this.onBlur = this.onBlur.bind(this);\n  }\n\n  onFocus() {\n    this.setState({ focussed: true });\n  }\n\n  onBlur() {\n    this.setState({ focussed: false });\n  }\n\n  render() {\n    const { focussed } = this.state;\n    const className = `feel-editor${focussed ? ' focussed' : ''}`;\n\n    // TODO(@barmac): display only a single editor;\n    // required to workaround \"replaceChild\" error\n    return <div className={ className } onClick={ this.onFocus }>\n      { focussed &&\n        <LiteralExpression\n          { ...this.props }\n          autoFocus={ true }\n          onBlur={ this.onBlur }\n        />\n      }\n      <ContentEditable\n        { ...this.props }\n        onInput={ () => {} }\n        onFocus={ this.onFocus }\n      />\n    </div>;\n  }\n}\n\nclass TableCellEditor extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this._expressionLanguages = context.injector.get('expressionLanguages');\n    this._translate = context.injector.get('translate');\n    this._variableResolver = context.injector.get('variableResolver', false);\n  }\n\n  isDefaultExpressionLanguage(businessObject) {\n    const { expressionLanguage } = businessObject;\n\n    const defaultExpressionLanguage = this.getDefaultExpressionLanguage(\n      businessObject\n    ).value;\n\n    return !expressionLanguage || expressionLanguage === defaultExpressionLanguage;\n  }\n\n  getDescription(businessObject) {\n    return businessObject.description;\n  }\n\n  getExpressionLanguageLabel(businessObject) {\n    const { expressionLanguage } = businessObject;\n\n    const defaultExpressionLanguage = this.getDefaultExpressionLanguage(businessObject);\n\n    return this._expressionLanguages.getLabel(expressionLanguage) ||\n      defaultExpressionLanguage.label;\n  }\n\n  isScript(businessObject) {\n    const defaultExpressionLanguage = this.getDefaultExpressionLanguage(businessObject);\n\n    const isInputCell = is(businessObject, 'dmn:UnaryTests');\n\n    if (!isInputCell) {\n      return false;\n    }\n\n    if (businessObject.text.indexOf('\\n') !== -1) {\n      return true;\n    }\n\n    return businessObject.expressionLanguage &&\n      businessObject.expressionLanguage !== defaultExpressionLanguage;\n  }\n\n  getDefaultExpressionLanguage(businessObject) {\n    const elementType = is(businessObject, 'dmn:UnaryTests') ? 'inputCell' : 'outputCell';\n\n    return this._expressionLanguages.getDefault(elementType);\n  }\n\n  getEditor() {\n    return this.isFEEL() ? FeelEditor : ContentEditable;\n  }\n\n  isFEEL() {\n    return this.getExpressionLanguage() === 'feel';\n  }\n\n  getExpressionLanguage() {\n    const { businessObject } = this.props;\n\n    return businessObject.expressionLanguage ||\n      this.getDefaultExpressionLanguage(businessObject).value;\n  }\n\n  _getVariables() {\n    const { businessObject } = this.props;\n\n    return this._variableResolver &&\n      this._variableResolver.getVariables(businessObject);\n  }\n\n  render() {\n    const {\n      businessObject,\n      placeholder,\n      value,\n      onChange\n    } = this.props;\n\n    const description = this.getDescription(businessObject);\n\n    const isDefaultExpressionLanguage = this.isDefaultExpressionLanguage(businessObject);\n\n    const expressionLanguageLabel = this.getExpressionLanguageLabel(businessObject);\n\n    const isScript = this.isScript(businessObject);\n\n    const Editor = this.getEditor();\n    const variables = this._getVariables();\n\n    return (\n      <div className=\"cell-editor\">\n        {\n          isString(description)\n            && <div className=\"description-indicator\"></div>\n        }\n        <Editor\n          className={ isScript ? 'script-editor' : '' }\n          ctrlForNewline={ true }\n          onInput={ onChange }\n          value={ value }\n          placeholder={ placeholder }\n          variables={ variables }\n        />\n        {\n          !isDefaultExpressionLanguage && (\n            <span\n              className=\"dms-badge dmn-expression-language\"\n              title={ this._translate(\n                'Expression language: {expressionLanguageLabel}',\n                { expressionLanguageLabel }\n              ) }>\n              <span class=\"dms-badge-icon dmn-icon-file-code\"></span>\n              <span class=\"dms-badge-label\">{ expressionLanguageLabel }</span>\n            </span>\n          )\n        }\n      </div>\n    );\n  }\n}\n"],"mappings":"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"}